#!/bin/bash

set -e

if [ -z $DEPENDABOT_NATIVE_HELPERS_PATH ]; then
  echo "Unable to build, DEPENDABOT_NATIVE_HELPERS_PATH is not set"
  exit 1
fi

install_dir="$DEPENDABOT_NATIVE_HELPERS_PATH/npm_and_yarn"
helpers_dir="$(dirname "${BASH_SOURCE[0]}")"
cp -r \
  "$helpers_dir/lib" \
  "$helpers_dir/test" \
  "$helpers_dir/run.js" \
  "$helpers_dir/.eslintrc" \
  "$helpers_dir/jest.config.js" \
  "$helpers_dir/package.json" \
  "$helpers_dir/package-lock.json" \
  "$install_dir"

cd "$install_dir"
npm ci --no-audit --fetch-timeout=600000 --fetch-retries=5
